<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <title>SSE via fetch</title>
</head>

<body>
    <pre id="log"></pre>
    <script>
        const log = (...args) => {
            document.getElementById('log').textContent += args.join(' ') + '\n';
        };

        let lastEventId = null; // 用于断线续传

        async function connectSSE() {
            try {
                log('[connect] 正在连接...');
                const res = await fetch('http://localhost:3000/sse');

                const reader = res.body.getReader();
                const decoder = new TextDecoder('utf-8');
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();

                    const chunkStr = decoder.decode(value, { stream: true });
                    console.log('value', done,  chunkStr)

                }
            } catch { }
        }

        connectSSE();
    </script>
</body>

</html>