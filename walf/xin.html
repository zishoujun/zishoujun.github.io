<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>蕊蕊~</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            background: black;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <canvas class="fireworks"
        style="position:fixed;left:0;top:0;z-index:99999999;pointer-events:none;max-height: 100%;overflow: hidden;"></canvas>
    <script src="./poiner.js"></script>
    <script>

        function getL() {
            const sentences = [
                "入眼尽是你，连呼吸都带着你的影子。",
                "四季更迭，我的世界始终围绕着你旋转。",
                "心中所有的风景，都不及你一颦一笑。",
                "万物有声，却不及你低语动人。",
                "每一次回眸，都像是整个宇宙为你停顿。",
                "日落再美，也比不上你眼里的光。",
                "我的世界很大，但装得下的，唯有你。",
                "春风十里，不及你一人入心。",
                "所有的路，都通向你所在的地方。"
            ];

            // 随机获取一条
            const randomSentence = sentences[Math.floor(Math.random() * sentences.length)];

            return randomSentence
        }

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const SPREAD_SPEED = 0.5;   // 粒子膨胀速度
        const PARTICLE_LIFE = 300;   // 粒子寿命
        const FADE_SPEED = 0.01;    // 粒子透明度衰减速度

        class Firework2 {
            constructor(sx, sy, tx, ty, color) {
                this.x = sx;
                this.y = sy;
                this.tx = tx;
                this.ty = ty;
                this.color = color;
                this.speed = 10;
                this.angle = Math.atan2(ty - sy, tx - sx);
                this.distance = Math.hypot(tx - sx, ty - sy);
                this.traveled = 0;
                this.exploded = false;
            }
            update() {
                if (!this.exploded) {
                    let vx = Math.cos(this.angle) * this.speed;
                    let vy = Math.sin(this.angle) * this.speed;
                    this.x += vx;
                    this.y += vy;
                    this.traveled = Math.hypot(this.x, this.y);
                    if (Math.hypot(this.x - this.tx, this.y - this.ty) < this.speed) {
                        this.exploded = true;
                        explodeHeart(this.tx, this.ty, this.color);
                    }
                }
            }
            draw(ctx) {
                if (!this.exploded) {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        class Particle2 {
            constructor(x, y, color, dx, dy) {
                this.x = x; this.y = y;
                this.color = color;
                this.dx = dx; this.dy = dy;
                this.alpha = 1;
                this.life = PARTICLE_LIFE;
            }
            update() {
                this.x += this.dx;
                this.y += this.dy;
                this.alpha -= FADE_SPEED;
                this.life--;
            }
            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        let fireworks = [];
        let particles = [];



        // 点击发射
        canvas.addEventListener("click", e => {
            let color = `hsl(${Math.random() * 360},100%,60%)`;
            fireworks.push(new Firework2(canvas.width / 2, canvas.height, e.clientX, e.clientY, color));
        });

        // 自动发射
        setInterval(() => {
            let tx = Math.random() * canvas.width;
            let ty = Math.random() * canvas.height / 2;
            let color = `hsl(${Math.random() * 360},100%,60%)`;
            fireworks.push(new Firework2(canvas.width / 2, canvas.height, tx, ty, color));
        }, 500);

        let heartTexts = []; // 存储心形文字

        function drawHeartTexts(ctx) {
            heartTexts.forEach((ht, i) => {
                ctx.save();
                ctx.globalAlpha = ht.alpha;
                ctx.fillStyle = ht.color; // 跟心颜色一致
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";

                let fontSize = 6 + (1 - ht.alpha) * 24;
                ctx.font = `bold ${fontSize}px 微软雅黑, Arial, sans-serif`;
                // 逗号分割折行
                const lines = ht.text.split("，");
                lines.forEach((line, idx) => {
                    ctx.fillText(line, ht.x, ht.y + (idx - (lines.length - 1) / 2) * (fontSize+5));
                });
                ctx.restore();
                // 透明度和生命周期衰减
                ht.alpha -= FADE_SPEED;
                ht.life--;
            });
            // 移除消失的文字
            heartTexts = heartTexts.filter(ht => ht.alpha > 0 && ht.life > 0);
        }

        // explodeHeart 里加 color
        function explodeHeart(x, y, color) {
            let scale = 6;
            for (let t = 0; t < Math.PI * 2; t += 0.05) {
                let hx = 16 * Math.pow(Math.sin(t), 3);
                let hy = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                let dx = (hx * scale / 20) * SPREAD_SPEED + (Math.random() - 0.5) * 0.1;
                let dy = -(hy * scale / 20) * SPREAD_SPEED + (Math.random() - 0.5) * 0.1;
                particles.push(new Particle2(x, y, color, dx, dy));
            }
            // 爆炸时生成心形文字
            const text = getL();
            heartTexts.push({
                x, y, text,
                color, // 记录心的颜色
                alpha: 1,
                life: PARTICLE_LIFE
            });
            if (heartTexts.length > 10) heartTexts.shift();
        }

        // 修改 animate 函数
        function animate() {
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            fireworks.forEach((f, i) => {
                f.update();
                f.draw(ctx);
                if (f.exploded) fireworks.splice(i, 1);
            });

            particles.forEach((p, i) => {
                p.update();
                p.draw(ctx);
                if (p.alpha <= 0 || p.life <= 0) particles.splice(i, 1);
            });

            drawHeartTexts(ctx); // 新增：绘制心形文字

            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>

</html>